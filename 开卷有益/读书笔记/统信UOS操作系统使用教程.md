#  《统信UOS操作系统使用教程》读书笔记

## 基础篇

### 第一章 统信操作系统简介

#### 1.1 统信软件

统信软件基于Linux内核采用同源异构技术打造的统信UOS，同时支持4中CPU架构（AMD64、ARM64、MIPS64、SW64）和七大CPU平台（龙芯、飞腾、海思麒麟、申威、鲲鹏、兆芯、海光）。

#### 1.2 统信产品介绍

统信软件研发了基于Linux内核的操作系统产品，即统信UOS。统信UOS包括统信桌面操作系统和 统信服务器操作系统。

### 第二章 统信UOS与Linux操作系统

#### 2.1 什么是操作系统

操作系统（Operating System，OS）是管理计算机所有软件和硬件的一个程序（归根结底是一个软件），起到承上启下的作用。

#### 2.2 Linux操作系统简介

**Linux的由来**

Linux是在GNU[^1]计划下，1991年芬兰大学的学生Linus出于个人兴趣，基于POSIX[^2]标准在x86处理器上开发的一个类Unix操作系统。Linux本身并没有什么超前的理论创新，也没有宏伟的蓝图设计，它最引人瞩目的是它的开发方式，它基于GPL2[^3]发布，其源代码能被任何人访问到，且任何人都能参与到Linux的开发中。

**Linux操作系统**

提起Linux时，一般是指Linux内核（kernel），==包含进程管理、内存管理、文件管理、设备管理等功能，作用是通过驱动程序和固件对底层硬件进行管理，并提供系统调用等一系列接口给应用使用==。一个Linux操作系统实际上就是在Linux内核的基础上，加上常用的软件库与软件形成的。

**Linux发行版**

各Linux发行版组织在Linux原生内核（香草内核）的基础上进行定制得到新的内核，并提供shell程序、常见的运行库、软件包管理程序、系统服务、常见的程序等，从而组成系统镜像和软件仓库，提供给普通用户使用。也就成为了俗称的发行版。

#### 2.3 统信UOS为什么选择Linux

从零打造操作系统主要的问题在于生态建设的时间问题。操作系统本身只是一个承载平台，用户感兴趣的是运行在操作系统之上的应用软件和操作系统对相关硬件的支持。

> 计算机行业具有天然的先发垄断性，因为开发者在设计软件和硬件的时候会以现在主流的操作系统兼容为目的来设计。因此若没有足够庞大的生态建设团队，从零开发操作系统就必须要对已经存在的软硬件和接口进行兼容，难度是非常高的。

### 第三章 统信UOS的安装

#### 3.1 操作系统安装的基础 知识

##### 3.1.1 BIOS[^4]概述

BIOS是一种业界标准的固件接口，本身是一组固化到计算机主板上的程序集合。==包括基本输入输出程序、开机后自检程序以及系统自启动程序等。==是计算机通电后第一个启动的程序。

它主要有以下三个功能：

1. 通电自检：检查CPU、内存、硬盘、串口、并口等是否损坏。
2. 初始化：创建中断向量、设置寄存器、设定硬件 参数 等。执行引导程序。
3. 与操作系统对接：将一部分与硬件处理有关的接口提供给操作系统，并处理操作系统指令和硬件中断的内容。

##### 3.1.2 UEFI[^5]和Legacy

随着硬件的迅速发展，传统BIOS已经成为了包袱，UEFI是传统BIOS的替代产物，也就是说==UEFI是一种新型的BIOS==，为了与传统的BIOS进行区分，我们称传统的BIOS为Legacy。

**UEFI相较于Legacy的优势**

- 安全性提高
- 支持大容量硬盘
- 启动项管理
- 人机操作支持

##### 3.1.3 分区和分区表

硬盘作为计算机主要的外部存储设备，其存储空间通常很大，为了能够更好地管理这么大的存储空间，一般采用硬盘分区的方式将硬盘拆分成多个分区（机械硬盘和固态硬盘都存在分区），根据分区方式的不同，在硬盘进行分区时需要在硬盘上记录不同的索引数据，用于维护硬盘上的分区信息（包括位置、大小等），这个索引数据就是==分区表==。Legacy用的是MBR[^6]分区表，而UEFI用的是GPT[^7].

##### 3.1.4 磁盘的相关知识

在了解MBR和GPT分区表的原理之前，首先需要对磁盘的一些基础有所掌握，因此在这里做简要的介绍。

**磁盘的物理结构**

![2-1Q012154JE59](https://raw.githubusercontent.com/chen-ustc/clouding/master/741682-20201008184142597-446492759.jpg)

<center>
    图3.1
</center>



==需要注意磁盘是上下磁头的，也就是说，一个盘片上有两个磁头进行操作==，如下图所示：

![2-1Q012154TC11](https://raw.githubusercontent.com/chen-ustc/clouding/main/img/741682-20201008184143175-534039438.jpg)

<center>图3.2
</center>



**磁盘的逻辑结构**

磁盘的逻辑结构主要分为柱面、磁道和扇区。

*柱面（cylinder）*

将一叠盘片摞在一起，俯视地划分成多个同心圆，则可以将这一摞盘片拆分成许多个有很多层的圆柱体，圆柱每层的上下面的集合就是柱面。

*磁道（track）*

图3.2中的每一个圆环就称为一个磁道，磁道的密度很高，通常一面上就有上千个磁道，但是相邻的磁道之间并不是紧挨着的，因为距离过近，磁化单元之间会相互产生影响。可以很明显地看到，==同一个盘面，磁道的长度是不一样的，同一个柱面，磁道的长度是一致的。==

*扇区（sector)*

![img](https://raw.githubusercontent.com/chen-ustc/clouding/main/img/741682-20201008184143484-515521414.jpg)

<center>
    图3。3
</center>

每个磁道被这个扇形覆盖的区域成为一个扇区，需要注意的是==除了最靠近圆心位置的磁道，其余的扇区都**不是**扇形的==。==扇区是磁盘最小的存储单位，也是能够独立寻址`Q&A`的最小单位，每个扇区的大小一般为512个byte==。

注$1\degree$:显然不同磁道上的扇区的形状和面积均是不同的，但是每个扇区所存储的字节数却一致，这是怎么做到的呢？很简单，因为不同磁道扇区上的磁化单元密度不同，但总数是相同的。也就是说==一个盘面上的扇区它们的磁密度实际上是不尽相同的，越靠外层就越疏，也越安全，因此主分区都是建立在外层磁道上的。==但其实后来为了增大磁盘容量采用了新技术，也就是说越往外磁道的扇区数目也就越多。

注$2\degree$：前面提到扇区是磁盘的最小存储单位，也是能够独立寻址的最小单位，但是==扇区并不是资源分配的最小单位==，资源分配的最小单位是簇（cluster），比如你下载一个文件 ，操作系统在给它分配存储空间时的最小单元不是扇区，而是簇，因此往往一个文件所占用的磁盘空间会大于其实际的大小。至于大出多少，就取决于簇的大小。

注$3\degree$:扇区是磁盘能够独立寻址的最小单位也就意味着内存要向一个扇区读/写内容时，就必须要将整个扇区（512B）全部读入到内存中进行操作，即使它要读/写的数据可能只有1B。

注$4\degree$:硬盘簇的大小分配为多少比较合适？

- 默认情况下，在格式化的时候如果没有指定簇的大小，那么系统会根据分区的大小选择默认的簇值。
- NTFS文件系统支持的簇的大小为1~128个扇区的大小。在NTFS文件系统中，簇的大小会影响到磁盘文件的排列，设置适当的簇的大小可以减少磁盘空间丢失和分区上碎片的数量。如果簇设置过大，会影响到磁盘的存储效率，反之如果设置的过小，则虽然会提高利用率，但是会产生大量的文件碎片。 

---

`Q&A`磁盘如何寻址，找到一个特定的扇区呢？

step1: 确定柱面（cylinder）

step2: 确定是哪个磁头（header），也就是要确定是在哪一个盘面的哪一面

step3：磁头找到指定的扇区（sector）

这也就是我们常说的CHS寻址法。

---

`Q&A`如何计算一个磁盘的容量大小？

$磁头数\times柱面数\times扇区数\times扇区字节数$

这个公式仅适用于最原始的每个扇区存储空间相等的情况。

##### 3.1.4 MBR和GPT

**MBR**

MBR分区表的大小为512B，由于分区表大小的限制，其中只能存有最多4个分区`Q&A`（至多4个主分区或者3个主分区和1个扩展分区）。且MBR分区表管理的硬盘容量不能超过2TB`Q&A`,在使用MBR和Legacy的启动方式时需要注意一下几个问题：

- 只有主分区和逻辑分区才能被格式化后作为数据访问的分区。
- Linux操作系统默认将1~4作为主分区或扩展分区的序号，逻辑分区的序号从5开始。

---

`Q&A `什么是分区？

一个硬盘有三种分区：

1. 主分区
2. 扩展分区
3. 逻辑分区

主分区，也叫引导分区，最多能创建四个，最少有一个，在MBR分区表管理的硬盘中，若创建4个主分区，则扩展分区就不存在了。

逻辑分区，从扩展分区中划分出一块，就成为一个逻辑分区，逻辑分区上不存在任何和操作系统有关联的东西，就是一块纯粹的存储介质，用来存放数据。

扩展分区，严格意义上来讲它并不是一个真正的分区，它仅仅是一个指向下一个分区的指针。这种指针结构会形成一个单向链表，这样分区表中除了存储主分区的信息之外，仅需要存储一个被称为扩展分区的信息，就可以顺藤摸瓜地找到所有的分区，节省了分区表中本就紧张的位置。

---

`Q&A`为什么MBR分区表管理的硬盘容量最大不能超过2TB？

上面提到过MBR分区表的大小为512个字节，但其中，446个字节用来存放引导信息，而仅剩64个字节用来存储硬盘上扇区的信息。MBR分区表的格式如下图：

![img](https://raw.githubusercontent.com/chen-ustc/clouding/main/img/1776217-20201206001835300-1726886129.png)

64个字节存储4个分区的信息，每个分区有16个字节，但$2^{128}$个扇区能存储的数据应远远大于2TB，但为什么只能存储2TB呢？

这是因为16个字节中并不全都用来存储扇区的信息，它们的利用方式是这样的：

![img](https://raw.githubusercontent.com/chen-ustc/clouding/main/img/1776217-20201206033908571-1315401908.png)

可以看到只有最后的DWORD，两个字，也就是4个字节用来存储扇区的总数，那么总数最大是多少呢？

$2^{32}=4294967296$

也就是说扇区的总数最多为4294967296个，而每个扇区都可以存储512B的内容。因此能表示的最大容量为：
$$
\begin{align}
2^{32}\times512
&=2199023255552B\\
&=2048GB\\
&=2TB
\end{align}
$$
硬盘厂商采用$1:1000$的比例进行换算，因此也有2.2TB一说。


## 简写的说明

[^1]: GNU:GNU is Not Unix
[^2]: POSIX: Portable Operating System Interface
[^3]: GPL: General Public License
[^4]: BIOS: Basic  Input Output System
[^5]: UEFI：Unified Extensible Firmware Interface
[^6]: MBR: Master Boot Record 主引导记录分区表
[^7]: GPT: GUID Partition Table 全局唯一标识磁盘分区表