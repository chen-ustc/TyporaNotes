# linux中的软件包管理

一般来说，常用的Linux发行版基本上分为两大类：

1. RedHat系列：RedHat、CentOS、Fedora等。
2. Debian系列：Debian、Ubuntu等。

常见的软件安装方式也分为两大类：

1. 安装包
   - rpm包（RedHat系列）
   - deb包（Debian系列）
2. tar包/源代码

Q：这两种安装方式有什么区别呢：

A：

1. 安装包一般都是预先编译好的文件 ，因而在安装过程中要求环境一致，比如一些依赖的库和其版本必须要满足某些条件，且它可能已经绑定到某种CPU或者发行版上面了，因而通用性较差。而tar包则是源代码，一般会包含编译脚本，可以在你的环境下自行编译，具有通用性。
2. 安装包是非开源的格式，而tar包是开源的。

注$1\degree$:什么是预先编译好的文件呢？

预先编译好，指用汇编器把汇编语言程序变成二进制文件或者用编译器把高级语言程序变成二进制文件。总而言之，预先编译好的文件已经是二进制的机器语言代码了，这时人已经无法阅读和理解这串01字符了，就C程序而言，它只需要再链接系统库函数就可以变成可执行文件了，这也就意味着，**我们无法对编译参数做出任何的选择和修改，我们也无法针对自己的硬件平台选用合适的编译器来优化程序的代码**。

注$2\degree$：在注$1\degree$中提到了编译参数，那么什么是编译参数，编译参数又有哪些呢？

不同的编译器有不同的参数 ，同种编译器不同的编程语言也有不同的编译参数，我们以gcc编译C/C++程序为例：

- -l（link）

  用于指定要链接的库，如-lm表示链接数学库。

  注$1\degree$:怎样找到库名：库文件一般存储在`/lib`和`/usr/lib`和`/usr/local/lib`文件夹中，以数学库为例，库文件名为`libm.so`，除去前面的lib前缀，后面的.so后缀，剩余的m即为库名。且静态库名为libxxx.a，而动态库名为libxxx.so。

- -o（out）

  指定输出的文件名，如果不指定，则输出的文件默认文件名为a.out

- -c（compile）

  只编译不链接，这样生成的文件名默认是 原文件名.o，当然也可以用-o重新指定文件名。

- -g（GNU debugger）

  加入调试信息，加了这个选项后生成的程序可以进行调试，但是可能程序的执行速度会受到影响。

- -On

  优化生成的目标代码，n表示优化的等级，n默认为1，当$n\ge2$时，生成的程序没有调试信息，不能进行调试，但是程序的效率会有所提高。最高级别为O3.

- -E

  对程序只做预处理，会将预处理结果输出到stdout上，而不是像-o或者-c会输出到文件，若要输出到文件，则需要用重定向。

- -C

  在预处理的时候，不删除注释信息，一般和-E搭配使用，可以用来分析程序。

- -M

  生成文件关联的信息，包含目标文件所以来的所有头文件

- -ggdb

  尽可能地生成 gdb可以使用的调试信息。

- -static

  此选项将禁止使用动态库，所以编译出来的东西一般都很大，但它也不需要什么动态链接库，就可以直接运行。

- -share

  此选项将尽量使用动态库，所以生成的文件比较小，但是需要系统有动态库。

- -traditional

  试图让编译器支持传统的C语言特性。

## rpm和deb软件包管理器简介

### RPM，rpm，.rpm傻傻分不清？

==RPM（红帽软件包管理器）和DEB（Debian软件包管理器）本质上是两个数据库性质的东西，其中记录的是软件信息及其与其他软件的依赖关系。rpm是用来安装软件的工具，.rpm是RedHat系列软件包的后缀名；同样地，DEB是Debian系列软件的信息与依赖关系数据库，dpkg（debain package）是用来安装软件的工具（称为命令也可以），.deb是Debian系列软件的后缀名。==

**上面的内容切莫混淆，否则会越看越迷糊**

### 为什么出现了这三个rpm？

在RPM公布 之前，要想 在linux系统中安装软件只能采取源码包的方式，早期在linux系统中安装软件是一件非常困难和耗费耐心的事，而且大多数的服务程序仅仅提供源代码，需要运维人员自己自行编译代码并解决非常多的软件依赖关系，在安装 、升级、卸载程序时都需要考虑到其他程序、库的依赖关系 ，因此在进行校验、安装、卸载、查询、升级等管理软件的操作时难度都非常大。为了解决依赖关系复杂的问题，RPM应运而生，RedHat公司对软件进行编译 ，得到.rpm后缀的软件，并分析其软件依赖关系，存储在RPM中，用rpm命令可以对.rpm格式的软件进行操作，如安装，升级，卸载，查询软件描述和依赖信息等。DEB，dpkg，.deb的功能是类似的。

可以用curl或者wget获得rpm软件包，但倘若软件包内缺少某些依赖，这时仍需要操作人员自行去下载和安装相关的依赖。**注意无论是使用rpm亦或是dpkg来安装软件都要求软件包已经被下载到了本地**。那么有没有办法让这里也能做出一些简化呢，当然可以，一个很理所当然的思路就是收集这些依赖软件放在一个仓库中，在用户联网的情况下，可以直接从仓库中获取依赖软件，并直接安装，确保host软件能够正确地安装。这也就是后面要提到的yum和apt-get软件仓库。

> 我的思考：我猜想有没有可能正是因为需要确定软件的依赖关系，因而需要预先对其进行编译，这样才能确保RPM中存储的依赖关系无误。

下面列出一些常用的rpm和dpkg命令：

1. rpm命令

| 命令                  | 作用                |
| --------------------- | ------------------- |
| rpm -ivh filename.rpm | 安装软件            |
| rpm -Uvh filename.rpm | 升级软件            |
| rpm -e filename.rpm   | 卸载软件            |
| rpm -qpi filename.rpm | 查询软件描述信息    |
| rpm -qpl filename.rpm | 列出软件文件信息    |
| rpm -qf filename      | 查询文件属于哪个RPM |
| rpm -qa               | 查询所有已安装的包  |

2. dpkg命令 

| 命令                | 作用                            |
| ------------------- | ------------------------------- |
| dpkg -i package.deb | 安装一个软件包                  |
| dpkg -c package.deb | 列出package.deb的内容           |
| dpkg -r package     | 卸载一个软件包                  |
| dpkg -p package.deb | 完全清除一个已安装的软件包      |
| dpkg -l package.deb | 从package.deb中提取软件包的信息 |
| dpkg -L package     | 列出package安装的所有文件清单   |

## yum和apt-get软件仓库简介

尽管RPM能够帮助用户查询软件相关的依赖关系，但问题还是要运维人员自己来解决，而有些大型软件可能与数十个程序都有依赖关系，在这种情况下安装软件会是非常痛苦的，yum软件仓库就是为了进一步降低软件安装难度和复杂度而设计的技术。yum软件仓库可以根据用户的要求分析出所需软件包及其相关的依赖关系，然后自动从服务器下载软件包并安装到系统。

**yum/apt-get的特点**

1. 可以同时配置多个资源库（repo），yum的配置文件在`/etc/yum.conf`中 ，apt-get的配置文件在`/etc/apt/sources.list`中。
2. 能够自动解决增加或删除rpm/deb包时遇到的依赖性问题。
3. 保持与RPM数据库的一致性。

## 源码安装简介

## 包管理软件安装和源码安装的比较

